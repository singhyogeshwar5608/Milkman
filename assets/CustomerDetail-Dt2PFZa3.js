import{d as z,c as Q,b as E,e as T,r as n,j as e,B as h,C as m,I as q}from"./index-B3Ma6YUV.js";import{c as D}from"./createLucideIcon-Cxa5orDZ.js";import{P as _,M as U}from"./phone-CxUxzk39.js";import{S as O}from"./share-2-C778O3UX.js";import{f as H}from"./format-DWPfdaBu.js";const W=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],C=D("arrow-left",W);const G=[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]],J=D("indian-rupee",G),se=()=>{const{id:i}=z(),j=Q(),{diaryEntries:L,payments:B,addPayment:F,getCustomerById:S,getDiaryEntriesByCustomer:y,getPaymentsByCustomer:f}=E(),A=T().state?.fromReports,t=i?S(i):void 0,c=n.useMemo(()=>i?y(i):[],[i,y,L]),x=n.useMemo(()=>i?f(i):[],[i,f,B]),l=n.useMemo(()=>{const s=c.reduce((d,o)=>d+o.quantity,0),a=c.reduce((d,o)=>d+o.amount,0),r=x.reduce((d,o)=>d+o.amount,0),u=a-r;return{totalDeliveredLiters:s,totalBilled:a,totalPaid:r,balance:u}},[c,x]),[N,g]=n.useState(""),[b,R]=n.useState("cash"),[v,k]=n.useState(""),[w,p]=n.useState(""),[P,M]=n.useState(!1);if(!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{variant:"secondary",onClick:()=>j(-1),children:[e.jsx(C,{className:"mr-2",size:18})," Back"]}),e.jsx("p",{className:"text-red-600",children:"Customer not found."})]});const I=async s=>{s.preventDefault(),p("");const a=parseFloat(N);if(!a||a<=0){p("Enter a valid amount");return}M(!0);try{const r=new Date().toISOString().slice(0,10);await F({customerId:t.id,amount:a,method:b,note:v||void 0,date:r}),g(""),k("")}catch(r){p(r?.message||"Failed to record payment")}finally{M(!1)}},$=()=>{if(!t.phone){alert("This customer does not have a phone number saved.");return}const s=t.phone.replace(/\D/g,""),r=[`Milk Report for ${t.name}`,`Total Milk Delivered: ${l.totalDeliveredLiters.toFixed(2)} L`,`Total Billed: ₹${l.totalBilled.toFixed(2)}`,`Total Paid: ₹${l.totalPaid.toFixed(2)}`,`Balance Due: ₹${l.balance.toFixed(2)}`].join(`
`),u=`https://wa.me/${s}?text=${encodeURIComponent(r)}`;window.open(u,"_blank")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{variant:"secondary",onClick:()=>j(-1),children:[e.jsx(C,{className:"mr-2",size:18})," ",A?"Back to Report":"Back to Customers"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4 lg:col-span-1",children:[e.jsxs(m,{title:"Customer Details",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:t.name}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Default Quantity"}),e.jsxs("span",{className:"font-medium",children:[t.defaultQuantity," L"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Price per Liter"}),e.jsxs("span",{className:"font-medium",children:["₹",t.pricePerUnit]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Daily Amount"}),e.jsxs("span",{className:"font-semibold text-green-700",children:["₹",(t.defaultQuantity*t.pricePerUnit).toFixed(2)]})]}),t.phone&&e.jsxs("div",{className:"flex items-center space-x-2 pt-2 border-t mt-2",children:[e.jsx(_,{size:16}),e.jsx("span",{children:t.phone})]}),t.address&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{size:16}),e.jsx("span",{children:t.address})]})]}),e.jsxs(h,{className:"mt-4 w-full flex items-center justify-center",variant:"primary",onClick:$,disabled:!t.phone,children:[e.jsx(O,{size:18,className:"mr-2"}),"Share Report on WhatsApp"]})]}),e.jsx(m,{title:"Account Summary",children:e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Milk Delivered"}),e.jsxs("span",{className:"font-medium",children:[l.totalDeliveredLiters.toFixed(2)," L"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Billed"}),e.jsxs("span",{className:"font-medium",children:["₹",l.totalBilled.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Paid"}),e.jsxs("span",{className:"font-medium text-green-700",children:["₹",l.totalPaid.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2 mt-2",children:[e.jsx("span",{children:"Balance Due"}),e.jsxs("span",{className:`font-bold flex items-center ${l.balance>0?"text-red-600":"text-green-700"}`,children:[e.jsx(J,{size:16,className:"mr-1"}),l.balance.toFixed(2)]})]})]})}),e.jsx(m,{title:"Recent Deliveries",children:c.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No deliveries recorded yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs md:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Date"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Qty (L)"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Amount (₹)"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Milk quality / Notes"})]})}),e.jsx("tbody",{children:c.slice().sort((s,a)=>a.date.localeCompare(s.date)).slice(0,20).map(s=>{const a=s.quantity>0?s.amount/s.quantity:0;return e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"py-2 px-2",children:H(new Date(s.date),"dd MMM yyyy")}),e.jsxs("td",{className:"py-2 px-2 text-right",children:[s.quantity.toFixed(2)," L",e.jsxs("span",{className:"block text-[11px] text-gray-500",children:["₹",a.toFixed(2)," / L"]})]}),e.jsxs("td",{className:"py-2 px-2 text-right font-semibold",children:["₹",s.amount.toFixed(2)]}),e.jsx("td",{className:"py-2 px-2 text-gray-600 max-w-[220px] truncate",children:s.milkQuality?s.milkQuality==="cow"?"Cow milk":s.milkQuality==="buffalo"?"Buffalo milk":s.milkQuality==="mixed"?"Mixed milk":"Other":s.notes||"-"})]},s.id)})})]})})})]}),e.jsxs("div",{className:"space-y-4 lg:col-span-2",children:[e.jsxs(m,{title:"Record Payment",children:[w&&e.jsx("p",{className:"mb-2 text-sm text-red-600",children:w}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsx(q,{label:"Amount (₹)",type:"number",min:"0",step:"0.01",value:N,onChange:s=>g(s.target.value),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Method"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:b,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsx(h,{type:"submit",className:"w-full",disabled:P,children:P?"Saving...":"Add Payment"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Note (optional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,value:v,onChange:s=>k(s.target.value),placeholder:"e.g., Paid for first week of November"})]})]})]}),e.jsx(m,{title:"Payment History",children:x.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No payments recorded yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Date"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Amount (₹)"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Method"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Note"})]})}),e.jsx("tbody",{children:x.slice().sort((s,a)=>s.date.localeCompare(a.date)).map(s=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"py-2 px-2",children:s.date}),e.jsxs("td",{className:"py-2 px-2 text-right font-medium",children:["₹",s.amount.toFixed(2)]}),e.jsx("td",{className:"py-2 px-2 capitalize",children:s.method}),e.jsx("td",{className:"py-2 px-2 text-gray-600",children:s.note||"-"})]},s.id))})]})})})]})]})]})};export{se as CustomerDetail};
