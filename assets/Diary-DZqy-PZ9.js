import{r as f,j as e,I as L,B as j,b as Q,u as P}from"./index-B3Ma6YUV.js";import{c as C}from"./createLucideIcon-Cxa5orDZ.js";import{T as _,P as O}from"./trash-2-CDTV4Bd7.js";import{M as T}from"./Modal-BNTK6mZB.js";import{C as B,a as U}from"./chevron-right-BhJLCnFn.js";import{t as $,c as R,f as v}from"./format-DWPfdaBu.js";const Y=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],X=C("circle-check-big",Y);const G=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],H=C("circle-x",G);function M(a,n,m){const c=$(a,m?.in);return isNaN(n)?R(a,NaN):(n&&c.setDate(c.getDate()+n),c)}function J(a,n,m){return M(a,-1,m)}const K=({customers:a,selectedDate:n,onSubmit:m,onCancel:c})=>{const[l,t]=f.useState({customerId:"",quantity:0,notes:"",delivered:!0,milkQuality:""}),[r,o]=f.useState({}),u=a.find(s=>s.id===l.customerId),k=s=>{const i=s.target.value,x=a.find(h=>h.id===i);t(h=>({...h,customerId:i,quantity:x?.defaultQuantity||0})),r.customerId&&o(h=>({...h,customerId:""}))},y=s=>{const{name:i,value:x,type:h}=s.target;t(b=>({...b,[i]:h==="number"?parseFloat(x)||0:x})),r[i]&&o(b=>({...b,[i]:""}))},w=()=>{const s={};return l.customerId||(s.customerId="Please select a customer"),l.quantity<=0&&(s.quantity="Quantity must be greater than 0"),o(s),Object.keys(s).length===0},p=s=>{if(s.preventDefault(),w()&&u){const i=l.quantity*u.pricePerUnit;m({customerId:l.customerId,date:n,quantity:l.quantity,amount:i,notes:l.notes,milkQuality:l.milkQuality||void 0,delivered:l.delivered})}};return e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer *"}),e.jsxs("select",{value:l.customerId,onChange:k,className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.customerId?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select a customer"}),a.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (Default: ",s.defaultQuantity,"L @ ₹",s.pricePerUnit,"/L)"]},s.id))]}),r.customerId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.customerId})]}),e.jsx(L,{label:"Quantity (Liters) *",name:"quantity",type:"number",step:"0.5",min:"0",value:l.quantity,onChange:y,error:r.quantity,placeholder:"Enter quantity"}),u&&l.quantity>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Amount: "}),"₹",(l.quantity*u.pricePerUnit).toFixed(2)]}),l.milkQuality&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Milk quality: ",e.jsx("span",{className:"font-medium uppercase",children:l.milkQuality})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Milk quality"}),e.jsxs("select",{name:"milkQuality",value:l.milkQuality,onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"",children:"Select (optional)"}),e.jsx("option",{value:"cow",children:"Cow milk"}),e.jsx("option",{value:"buffalo",children:"Buffalo milk"}),e.jsx("option",{value:"mixed",children:"Mixed"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",value:l.notes,onChange:y,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Add any notes (optional)"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"delivered",checked:l.delivered,onChange:s=>t(i=>({...i,delivered:s.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"delivered",className:"ml-2 block text-sm text-gray-700",children:"Mark as delivered"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:c,children:"Cancel"}),e.jsx(j,{type:"submit",variant:"primary",children:"Add Delivery"})]})]})},V=({entries:a,customers:n,onDelete:m,onToggleDelivered:c})=>{const l=t=>n.find(r=>r.id===t)?.name||"Unknown";return a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg",children:"No deliveries for this date"}),e.jsx("p",{className:"text-sm mt-2",children:"Add a delivery to get started"})]}):e.jsxs("div",{className:"space-y-2",children:[a.map(t=>e.jsx("div",{className:`bg-white border rounded-lg p-3 md:p-4 ${t.delivered?"border-green-200":"border-gray-200"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-gray-900",children:l(t.customerId)}),e.jsx("button",{onClick:()=>c(t.id,!t.delivered),className:"text-sm",title:t.delivered?"Mark as not delivered":"Mark as delivered",children:t.delivered?e.jsx(X,{size:18,className:"text-green-600"}):e.jsx(H,{size:18,className:"text-gray-400"})})]}),e.jsxs("div",{className:"mt-1.5 space-y-1 text-xs md:text-sm text-gray-600",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Quantity:"})," ",t.quantity," L"]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Amount:"})," ₹",t.amount.toFixed(2)]})]}),t.notes&&e.jsxs("div",{className:"text-gray-500 italic",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",t.notes]})]})]}),e.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to delete this delivery?")&&m(t.id)},className:"text-red-600 hover:text-red-800 ml-3",title:"Delete",children:e.jsx(_,{size:16})})]})},t.id)),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 md:p-4 mt-3 md:mt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Total for this date:"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-base md:text-lg font-semibold text-gray-900",children:["₹",a.reduce((t,r)=>t+r.amount,0).toFixed(2)]}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-600",children:[a.reduce((t,r)=>t+r.quantity,0).toFixed(1)," L"]})]})]})})]})},re=()=>{const{customers:a,diaryEntries:n,subscription:m,addDiaryEntry:c,deleteDiaryEntry:l,updateDiaryEntry:t}=Q(),{user:r}=P(),[o,u]=f.useState(v(new Date,"yyyy-MM-dd")),[k,y]=f.useState(!1),[w,p]=f.useState(!1),[s,i]=f.useState("all"),x=f.useMemo(()=>n.filter(d=>d.date===o),[n,o]),h=f.useMemo(()=>s==="delivered"?x.filter(d=>d.delivered):s==="not_delivered"?x.filter(d=>!d.delivered):x,[x,s]),N=(r?.email?.toLowerCase()||"")==="larawansdigital@gmail.com"?null:m?.entryLimit??3,D=n.length,g=N===null?null:Math.max(N-D,0),q=()=>{u(v(J(new Date(o)),"yyyy-MM-dd"))},E=()=>{u(v(M(new Date(o),1),"yyyy-MM-dd"))},I=()=>{u(v(new Date,"yyyy-MM-dd"))},F=()=>{if(a.length===0){alert("Please add customers first before recording deliveries.");return}y(!0)},z=d=>{c(d),y(!1)},A=(d,S)=>{t(d,{delivered:S})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-slate-50",children:"Daily Diary"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 dark:text-slate-300 mt-1",children:"Record and track daily milk deliveries"})]}),e.jsxs(j,{size:"sm",onClick:F,className:"w-full sm:w-auto justify-center",children:[e.jsx(O,{size:20,className:"mr-2"}),"Add Delivery"]})]}),N!==null&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"rounded-lg bg-yellow-50 dark:bg-yellow-900/40 border border-yellow-200 dark:border-yellow-700 px-4 py-2 text-xs sm:text-sm text-yellow-800 dark:text-yellow-100",children:[e.jsx("span",{className:"font-medium",children:"Demo usage:"})," ",D," of ",N," free entries used."," ",g!==null&&g>0&&e.jsxs("span",{children:["You have ",e.jsx("span",{className:"font-semibold",children:g})," left."]}),g!==null&&g<=0&&e.jsx("span",{children:"Your free entries are finished."})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 dark:bg-slate-800 dark:border dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:q,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(B,{size:24})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"date",value:o,onChange:d=>u(d.target.value),className:"px-3 py-1.5 md:px-4 md:py-2 text-sm md:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(j,{variant:"secondary",size:"sm",onClick:I,children:"Today"})]}),e.jsx("button",{onClick:E,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(U,{size:24})})]}),e.jsx("div",{className:"text-center mt-3 md:mt-4",children:e.jsx("p",{className:"text-lg md:text-2xl font-bold text-gray-900",children:v(new Date(o),"EEEE, MMMM dd, yyyy")})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 md:mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold",children:"Deliveries"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{size:"sm",variant:"secondary",onClick:()=>p(d=>!d),children:"Filter"}),w&&e.jsxs("div",{className:"absolute right-0 mt-2 w-40 bg-white border border-gray-200 rounded-lg shadow-lg z-10 text-sm",children:[e.jsx("button",{className:`w-full text-left px-3 py-2 hover:bg-gray-100 ${s==="all"?"font-semibold":""}`,onClick:()=>{i("all"),p(!1)},children:"All"}),e.jsx("button",{className:`w-full text-left px-3 py-2 hover:bg-gray-100 ${s==="delivered"?"font-semibold":""}`,onClick:()=>{i("delivered"),p(!1)},children:"Delivered"}),e.jsx("button",{className:`w-full text-left px-3 py-2 hover:bg-gray-100 ${s==="not_delivered"?"font-semibold":""}`,onClick:()=>{i("not_delivered"),p(!1)},children:"Not delivered"})]})]})]}),e.jsx(V,{entries:h,customers:a,onDelete:l,onToggleDelivered:A})]}),e.jsx(T,{isOpen:k,onClose:()=>y(!1),title:"Add Delivery",children:e.jsx(K,{customers:a,selectedDate:o,onSubmit:z,onCancel:()=>y(!1)})})]})};export{re as Diary};
