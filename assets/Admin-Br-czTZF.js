import{u as L,r as i,o as y,f as j,j as e,C as S,B as E,g as d,s as I,h as M}from"./index-B3Ma6YUV.js";const v="singh.yogeshwar5608@gmail.com",o={demo:{label:"Demo - 3 entries free",months:0,entryLimit:3},monthly:{label:"Monthly - ₹99",months:1,entryLimit:null},half_yearly:{label:"6 Months - ₹549",months:6,entryLimit:null},yearly:{label:"12 Months - ₹1049",months:12,entryLimit:null}},C=()=>{const{user:m}=L(),[x,b]=i.useState([]),[h,f]=i.useState([]),[g,p]=i.useState(null),l=m?.email===v;i.useEffect(()=>{if(!l)return;const s=y(j(d,"users"),t=>{const r=t.docs.map(a=>({id:a.id,...a.data()}));b(r)}),n=y(j(d,"subscriptions"),t=>{const r=t.docs.map(a=>({id:a.id,...a.data()}));f(r)});return()=>{s(),n()}},[l]);const N=i.useMemo(()=>{const s=new Map;return h.forEach(n=>{s.set(n.userId,n)}),s},[h]),w=async(s,n)=>{try{p(s.id);const t=o[n],r=new Date,a=r.toISOString().slice(0,10);let u=null;if(t.months>0){const c=new Date(r);c.setMonth(c.getMonth()+t.months),u=c.toISOString().slice(0,10)}await I(M(d,"subscriptions",s.id),{userId:s.id,plan:n,entryLimit:t.entryLimit,startDate:a,endDate:u},{merge:!0})}catch(t){console.error("Failed to update subscription",t),alert("Failed to update subscription. See console for details.")}finally{p(null)}};return m?l?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage user subscriptions. When a user messages you, select their plan here."})]})}),e.jsx(S,{title:"Users and Subscriptions",children:x.length===0?e.jsx("p",{className:"text-gray-500",children:"No users found yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Email"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Created"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Current Plan"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Ends"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Entry Limit"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Change Plan"})]})}),e.jsx("tbody",{children:x.map(s=>{const n=N.get(s.id);return e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:s.email}),e.jsx("td",{className:"py-2 px-2 text-gray-600",children:s.createdAt?.slice(0,10)||"-"}),e.jsx("td",{className:"py-2 px-2 text-gray-800",children:n?.plan||"demo (implicit)"}),e.jsx("td",{className:"py-2 px-2 text-gray-600",children:n?.endDate||"-"}),e.jsx("td",{className:"py-2 px-2 text-gray-600",children:n?.entryLimit===null?"Unlimited":n?.entryLimit??3}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(o).map(t=>e.jsx(E,{size:"sm",variant:n?.plan===t?"primary":"secondary",onClick:()=>w(s,t),disabled:g===s.id,children:o[t].label},t))})})]},s.id)})})]})})})]}):e.jsx("p",{className:"text-red-600",children:"Access denied. This page is only for the owner."}):e.jsx("p",{className:"text-red-600",children:"You must be logged in to view this page."})};export{C as Admin};
